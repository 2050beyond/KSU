<div class="home-catalog">
  <!-- Filter Menu -->
  <nav class="filter-menu">
    <button class="filter-link active" data-filter="all" onclick="filterProducts('all')">all</button>
    {% for collection in collections %}
      {% unless collection.handle == 'all' or collection.handle == 'frontpage' %}
        <button class="filter-link" data-filter="{{ collection.handle }}" onclick="filterProducts('{{ collection.handle }}')">{{ collection.title | downcase }}</button>
      {% endunless %}
    {% endfor %}
  </nav>

  <!-- Product Grid -->
  {% paginate collections.all.products by 200 %}
    <div class="product-grid" id="product-grid">
      {% comment %} First loop: Render all AVAILABLE products {% endcomment %}
      {% for product in collections.all.products %}
        {% if product.available %}
          {% comment %} Get all collection handles this product belongs to {% endcomment %}
          {% assign product_collections = '' %}
          {% for collection in product.collections %}
            {% if product_collections == '' %}
              {% assign product_collections = collection.handle %}
            {% else %}
              {% assign product_collections = product_collections | append: ',' | append: collection.handle %}
            {% endif %}
          {% endfor %}
          
          {% comment %} Check if new (has "new" tag OR published within 30 days) {% endcomment %}
          {% assign is_new = false %}
          {% if product.tags contains 'new' %}
            {% assign is_new = true %}
          {% else %}
            {% comment %} Check if published within last 30 days {% endcomment %}
            {% assign published_timestamp = product.published_at | date: '%s' | plus: 0 %}
            {% assign current_timestamp = 'now' | date: '%s' | plus: 0 %}
            {% assign seconds_since_published = current_timestamp | minus: published_timestamp %}
            {% assign days_since_published = seconds_since_published | divided_by: 86400 %}
            {% if days_since_published <= 30 and days_since_published >= 0 %}
              {% assign is_new = true %}
            {% endif %}
          {% endif %}
          
          <a 
            href="{{ product.url }}" 
            class="product-card" 
            data-collection-handles="{{ product_collections }}"
          >
            <div class="product-image">
              {% if product.featured_image %}
                <img 
                  src="{{ product.featured_image | img_url: '600x800' }}" 
                  alt="{{ product.title | escape }}"
                  loading="lazy"
                >
              {% else %}
                <div class="no-image">no image</div>
              {% endif %}
            </div>
            <div class="product-title">
              {{ product.title }}
              {% if is_new %}
                <span class="new-badge">[new]</span>
              {% endif %}
            </div>
            <div class="product-price">
              {{ product.price | money }}
            </div>
          </a>
        {% endif %}
      {% endfor %}
      
      {% comment %} Second loop: Render all SOLD OUT products {% endcomment %}
      {% for product in collections.all.products %}
        {% unless product.available %}
          {% comment %} Get all collection handles this product belongs to {% endcomment %}
          {% assign product_collections = '' %}
          {% for collection in product.collections %}
            {% if product_collections == '' %}
              {% assign product_collections = collection.handle %}
            {% else %}
              {% assign product_collections = product_collections | append: ',' | append: collection.handle %}
            {% endif %}
          {% endfor %}
          
          <a 
            href="{{ product.url }}" 
            class="product-card is-sold-out" 
            data-collection-handles="{{ product_collections }}"
          >
            <div class="product-image">
              {% if product.featured_image %}
                <img 
                  src="{{ product.featured_image | img_url: '600x800' }}" 
                  alt="{{ product.title | escape }}"
                  loading="lazy"
                >
              {% else %}
                <div class="no-image">no image</div>
              {% endif %}
            </div>
            <div class="product-title">
              {{ product.title }}
            </div>
            <div class="product-price">
              sold out
            </div>
          </a>
        {% endunless %}
      {% endfor %}
    </div>
  {% endpaginate %}
</div>

<style>
  .home-catalog {
    padding: 20px 0;
  }

  /* Filter Menu */
  .filter-menu {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 30px;
    padding: 0 20px;
  }

  .filter-link {
    font-family: Arial, sans-serif;
    font-size: 12px;
    line-height: 1.25;
    text-transform: lowercase;
    background: transparent;
    border: none;
    padding: 0;
    cursor: pointer;
    color: #999999;
    text-decoration: none;
    transition: color 0.2s;
  }

  .filter-link:hover {
    color: #666666;
  }

  .filter-link.active {
    color: #000000;
    font-weight: bold;
  }

  /* Product Grid */
  .product-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 15px;
    padding: 0 20px;
  }

  .product-card {
    text-decoration: none;
    color: #000000;
    display: block;
  }

  .product-image {
    aspect-ratio: 3/4;
    overflow: hidden;
    margin-bottom: 10px;
  }

  .product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .no-image {
    width: 100%;
    height: 100%;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999999;
    font-family: Arial, sans-serif;
    font-size: 12px;
    text-transform: lowercase;
  }

  .product-title {
    font-family: Arial, sans-serif;
    font-size: 12px;
    line-height: 1.25;
    text-transform: lowercase;
    margin-bottom: 5px;
  }

  .new-badge {
    font-style: italic;
    margin-left: 5px;
  }

  .product-price {
    font-family: Arial, sans-serif;
    font-size: 12px;
    line-height: 1.25;
    text-transform: lowercase;
  }

  /* Sold Out Styling */
  .product-card.is-sold-out {
    opacity: 0.5;
    color: #888888;
  }

  .product-card.is-sold-out .product-image img {
    filter: grayscale(100%);
  }

  /* Hide filtered products */
  .product-card.hidden {
    display: none;
  }

  /* Mobile */
  @media (max-width: 768px) {
    .product-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding: 0 15px;
    }

    .filter-menu {
      gap: 15px;
      padding: 0 15px;
    }
  }
</style>

<script>
  function filterProducts(collectionHandle) {
    // Update active state
    const filterLinks = document.querySelectorAll('.filter-link');
    filterLinks.forEach(link => {
      link.classList.remove('active');
      if (link.dataset.filter === collectionHandle) {
        link.classList.add('active');
      }
    });

    // Filter products
    const productCards = document.querySelectorAll('.product-card');
    
    productCards.forEach(card => {
      if (collectionHandle === 'all') {
        card.classList.remove('hidden');
      } else {
        const handles = card.dataset.collectionHandles || '';
        const handlesArray = handles.split(',').map(h => h.trim());
        
        if (handlesArray.includes(collectionHandle)) {
          card.classList.remove('hidden');
        } else {
          card.classList.add('hidden');
        }
      }
    });
  }

  // Initialize: show all products
  document.addEventListener('DOMContentLoaded', function() {
    filterProducts('all');
  });
</script>

{% schema %}
{
  "name": "Home Catalog",
  "settings": []
}
{% endschema %}
