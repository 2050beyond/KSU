<div class="main-product">
  <!-- Image Carousel (Top Half) -->
  <div class="product-carousel-wrapper">
    <div class="product-carousel" id="product-carousel">
      {% for image in product.images %}
        <div class="carousel-slide">
          <img 
            src="{{ image | img_url: '1200x1600' }}" 
            alt="{{ product.title | escape }}"
            loading="lazy"
          >
        </div>
      {% endfor %}
    </div>
    
    <!-- Carousel Navigation Arrows -->
    {% if product.images.size > 1 %}
      <button class="carousel-arrow carousel-prev" onclick="scrollCarousel(-1)" aria-label="Previous image">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.5 9L4.5 6L7.5 3" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="carousel-arrow carousel-next" onclick="scrollCarousel(1)" aria-label="Next image">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4.5 3L7.5 6L4.5 9" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    {% endif %}
  </div>

  <!-- Product Info (Bottom Half) -->
  <div class="product-info">
    <div class="product-info-content">
      <!-- Title -->
      <h1 class="product-title">{{ product.title }}</h1>

      <!-- Price -->
      <div class="product-price">{{ product.price | money }}</div>

      <!-- Variant Pickers -->
      <form id="add-to-cart-form" class="product-form">
        {% for option in product.options_with_values %}
          <div class="variant-option">
            <div class="option-name">{{ option.name }}</div>
            <div class="option-values">
              {% for value in option.values %}
                <button
                  type="button"
                  class="variant-value {% if forloop.first %}selected{% endif %}"
                  data-option="{{ option.name }}"
                  data-value="{{ value }}"
                  onclick="selectVariant(this, '{{ option.name }}', '{{ value }}')"
                >
                  {{ value }}
                </button>
              {% endfor %}
            </div>
          </div>
        {% endfor %}

        <!-- Hidden input for selected variant -->
        <input type="hidden" name="id" id="product-variant-id" value="{{ product.selected_or_first_available_variant.id }}">

        <!-- Add to Cart Button -->
        <button type="submit" class="add-to-cart-btn">
          add to cart — {{ product.selected_or_first_available_variant.price | money }}
        </button>
      </form>

      <!-- Description -->
      <div class="product-description">
        {{ product.description }}
      </div>
    </div>
  </div>
</div>

<style>
  .main-product {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* Image Carousel */
  .product-carousel-wrapper {
    width: 100vw;
    height: 70vh;
    position: relative;
    background: #FFFFFF;
  }

  .product-carousel {
    width: 100%;
    height: 100%;
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -ms-overflow-style: none;
    scroll-behavior: smooth;
  }

  .product-carousel::-webkit-scrollbar {
    display: none;
  }

  .carousel-slide {
    flex: 0 0 100%;
    scroll-snap-align: start;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #FFFFFF;
  }

  .carousel-slide img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
  }

  /* Carousel Arrows */
  .carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #FFFFFF;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: opacity 0.2s;
  }

  .carousel-arrow:hover {
    opacity: 0.8;
  }

  .carousel-prev {
    left: 20px;
  }

  .carousel-next {
    right: 20px;
  }

  /* Product Info */
  .product-info {
    padding: 20px;
    flex: 1;
    display: flex;
    justify-content: center;
  }

  .product-info-content {
    max-width: 420px;
    width: 100%;
  }

  .product-title {
    font-family: Arial, sans-serif;
    font-size: 12px;
    line-height: 1.25;
    text-transform: lowercase;
    color: #000000;
    margin-bottom: 15px;
    font-weight: normal;
  }

  .product-price {
    font-family: Arial, sans-serif;
    font-size: 14px;
    line-height: 1.25;
    text-transform: lowercase;
    color: #000000;
    margin-bottom: 30px;
  }

  /* Variant Options - Pill Style */
  .variant-option {
    margin-bottom: 20px;
  }

  .option-name {
    font-family: Arial, sans-serif;
    font-size: 12px;
    line-height: 1.25;
    text-transform: lowercase;
    color: #999999;
    margin-bottom: 8px;
  }

  .option-values {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .variant-value {
    font-family: Arial, sans-serif;
    font-size: 12px;
    line-height: 1.25;
    text-transform: lowercase;
    background: #fefefe;
    border: 1px solid #e5e5e5;
    border-radius: 999px;
    padding: 8px 16px;
    cursor: pointer;
    color: #000000;
    transition: all 0.2s;
  }

  .variant-value:hover {
    background: #f5f5f5;
  }

  .variant-value.selected {
    background: #000000;
    color: #FFFFFF;
    border-color: #000000;
  }

  /* Add to Cart Button - Compact */
  .add-to-cart-btn {
    width: auto;
    min-width: 200px;
    padding: 12px 24px;
    background: #000000;
    color: #FFFFFF;
    font-family: Arial, sans-serif;
    font-size: 12px;
    line-height: 1.25;
    text-transform: lowercase;
    border: none;
    border-radius: 999px;
    cursor: pointer;
    margin-top: 20px;
    margin-bottom: 30px;
    transition: opacity 0.2s;
  }

  .add-to-cart-btn:hover {
    opacity: 0.8;
  }

  .add-to-cart-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Description */
  .product-description {
    font-family: Arial, sans-serif;
    font-size: 12px;
    line-height: 1.5;
    text-transform: lowercase;
    color: #000000;
    margin-top: 30px;
    max-width: 420px;
  }

  .product-description p {
    margin-bottom: 15px;
  }
</style>

<script>
  // Variant selection logic
  let selectedOptions = {};
  
  {% for option in product.options_with_values %}
    selectedOptions['{{ option.name }}'] = '{{ option.values.first }}';
  {% endfor %}

  function selectVariant(button, optionName, value) {
    // Update selected state
    const optionGroup = button.closest('.variant-option');
    const allButtons = optionGroup.querySelectorAll('.variant-value');
    allButtons.forEach(btn => btn.classList.remove('selected'));
    button.classList.add('selected');

    // Store selection
    selectedOptions[optionName] = value;

    // Find matching variant
    const variant = findVariant(selectedOptions);
    
    if (variant) {
      document.getElementById('product-variant-id').value = variant.id;
      
      // Update price in button
      const price = formatMoney(variant.price);
      const addToCartBtn = document.querySelector('.add-to-cart-btn');
      addToCartBtn.textContent = `add to cart — ${price}`;
      
      // Disable button if variant unavailable
      addToCartBtn.disabled = !variant.available;
    }
  }

  function findVariant(options) {
    const variants = {{ product.variants | json }};
    
    for (let variant of variants) {
      let match = true;
      for (let i = 0; i < variant.options.length; i++) {
        const optionName = {{ product.options | json }}[i];
        if (options[optionName] !== variant.options[i]) {
          match = false;
          break;
        }
      }
      if (match) return variant;
    }
    return null;
  }

  function formatMoney(cents) {
    return new Intl.NumberFormat('{{ shop.locale }}', {
      style: 'currency',
      currency: '{{ shop.currency }}'
    }).format(cents / 100);
  }

  // Carousel navigation
  function scrollCarousel(direction) {
    const carousel = document.getElementById('product-carousel');
    const slideWidth = carousel.offsetWidth;
    const currentScroll = carousel.scrollLeft;
    const targetScroll = currentScroll + (slideWidth * direction);
    
    carousel.scrollTo({
      left: targetScroll,
      behavior: 'smooth'
    });
  }

  // Handle form submission
  document.getElementById('add-to-cart-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const variantId = document.getElementById('product-variant-id').value;
    const button = this.querySelector('.add-to-cart-btn');
    
    if (!variantId) {
      alert('please select all options');
      return;
    }

    button.disabled = true;
    button.textContent = 'adding...';

    try {
      const response = await fetch('/cart/add.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          id: variantId,
          quantity: 1
        })
      });

      if (!response.ok) {
        throw new Error('failed to add to cart');
      }

      // Update cart count
      if (typeof updateCartCount === 'function') {
        updateCartCount();
      }

      button.textContent = 'added to cart';
      setTimeout(() => {
        const currentVariant = findVariant(selectedOptions);
        const price = currentVariant ? formatMoney(currentVariant.price) : '{{ product.selected_or_first_available_variant.price | money }}';
        button.textContent = `add to cart — ${price}`;
        button.disabled = false;
      }, 1500);

    } catch (error) {
      console.error('Error adding to cart:', error);
      alert('failed to add item to cart');
      button.disabled = false;
      button.textContent = `add to cart — ${formatMoney(findVariant(selectedOptions).price)}`;
    }
  });
</script>

{% schema %}
{
  "name": "Main Product",
  "settings": []
}
{% endschema %}
